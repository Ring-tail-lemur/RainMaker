// https://d3js.org/d3-contour/ v3.1.0 Copyright 2012-2021 Mike Bostock
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-array"],r):r((t="undefined"!=typeof globalThis?globalThis:t||self).d3=t.d3||{},t.d3)}(this,(function(t,r){"use strict";var n=Array.prototype.slice;function e(t,r){return t-r}var o=t=>()=>t;function a(t,r){for(var n,e=-1,o=r.length;++e<o;)if(n=i(t,r[e]))return n;return 0}function i(t,r){for(var n=r[0],e=r[1],o=-1,a=0,i=t.length,f=i-1;a<i;f=a++){var u=t[a],c=u[0],d=u[1],l=t[f],s=l[0],g=l[1];if(h(u,l,r))return 0;d>e!=g>e&&n<(s-c)*(e-d)/(g-d)+c&&(o=-o)}return o}function h(t,r,n){var e,o,a,i;return function(t,r,n){return(r[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(r[1]-t[1])}(t,r,n)&&(o=t[e=+(t[0]===r[0])],a=n[e],i=r[e],o<=a&&a<=i||i<=a&&a<=o)}function f(){}var u=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function c(){var t=1,i=1,h=r.thresholdSturges,c=g;function d(t){var n=h(t);if(Array.isArray(n))n=n.slice().sort(e);else{const e=r.extent(t),o=r.tickStep(e[0],e[1],n);n=r.ticks(Math.floor(e[0]/o)*o,Math.floor(e[1]/o-1)*o,n)}return n.map((r=>l(t,r)))}function l(r,n){var e=[],o=[];return function(r,n,e){var o,a,h,f,c,d,l=new Array,g=new Array;o=a=-1,f=r[0]>=n,u[f<<1].forEach(v);for(;++o<t-1;)h=f,f=r[o+1]>=n,u[h|f<<1].forEach(v);u[f<<0].forEach(v);for(;++a<i-1;){for(o=-1,f=r[a*t+t]>=n,c=r[a*t]>=n,u[f<<1|c<<2].forEach(v);++o<t-1;)h=f,f=r[a*t+t+o+1]>=n,d=c,c=r[a*t+o+1]>=n,u[h|f<<1|c<<2|d<<3].forEach(v);u[f|c<<3].forEach(v)}o=-1,c=r[a*t]>=n,u[c<<2].forEach(v);for(;++o<t-1;)d=c,c=r[a*t+o+1]>=n,u[c<<2|d<<3].forEach(v);function v(t){var r,n,i=[t[0][0]+o,t[0][1]+a],h=[t[1][0]+o,t[1][1]+a],f=s(i),u=s(h);(r=g[f])?(n=l[u])?(delete g[r.end],delete l[n.start],r===n?(r.ring.push(h),e(r.ring)):l[r.start]=g[n.end]={start:r.start,end:n.end,ring:r.ring.concat(n.ring)}):(delete g[r.end],r.ring.push(h),g[r.end=u]=r):(r=l[u])?(n=g[f])?(delete l[r.start],delete g[n.end],r===n?(r.ring.push(h),e(r.ring)):l[n.start]=g[r.end]={start:n.start,end:r.end,ring:n.ring.concat(r.ring)}):(delete l[r.start],r.ring.unshift(i),l[r.start=f]=r):l[f]=g[u]={start:f,end:u,ring:[i,h]}}u[c<<3].forEach(v)}(r,n,(function(t){c(t,r,n),function(t){for(var r=0,n=t.length,e=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++r<n;)e+=t[r-1][1]*t[r][0]-t[r-1][0]*t[r][1];return e}(t)>0?e.push([t]):o.push(t)})),o.forEach((function(t){for(var r,n=0,o=e.length;n<o;++n)if(-1!==a((r=e[n])[0],t))return void r.push(t)})),{type:"MultiPolygon",value:n,coordinates:e}}function s(r){return 2*r[0]+r[1]*(t+1)*4}function g(r,n,e){r.forEach((function(r){var o,a=r[0],h=r[1],f=0|a,u=0|h,c=n[u*t+f];a>0&&a<t&&f===a&&(o=n[u*t+f-1],r[0]=a+(e-o)/(c-o)-.5),h>0&&h<i&&u===h&&(o=n[(u-1)*t+f],r[1]=h+(e-o)/(c-o)-.5)}))}return d.contour=l,d.size=function(r){if(!arguments.length)return[t,i];var n=Math.floor(r[0]),e=Math.floor(r[1]);if(!(n>=0&&e>=0))throw new Error("invalid size");return t=n,i=e,d},d.thresholds=function(t){return arguments.length?(h="function"==typeof t?t:Array.isArray(t)?o(n.call(t)):o(t),d):h},d.smooth=function(t){return arguments.length?(c=t?g:f,d):c===g},d}function d(t,r,n){for(var e=t.width,o=t.height,a=1+(n<<1),i=0;i<o;++i)for(var h=0,f=0;h<e+n;++h)h<e&&(f+=t.data[h+i*e]),h>=n&&(h>=a&&(f-=t.data[h-a+i*e]),r.data[h-n+i*e]=f/Math.min(h+1,e-1+a-h,a))}function l(t,r,n){for(var e=t.width,o=t.height,a=1+(n<<1),i=0;i<e;++i)for(var h=0,f=0;h<o+n;++h)h<o&&(f+=t.data[i+h*e]),h>=n&&(h>=a&&(f-=t.data[i+(h-a)*e]),r.data[i+(h-n)*e]=f/Math.min(h+1,o-1+a-h,a))}function s(t){return t[0]}function g(t){return t[1]}function v(){return 1}t.contourDensity=function(){var t=s,e=g,a=v,i=960,h=500,f=20,u=2,w=3*f,p=i+2*w>>u,y=h+2*w>>u,M=o(20);function E(r){var n=new Float32Array(p*y),o=new Float32Array(p*y),i=Math.pow(2,-u);return r.forEach((function(r,o,h){var f=(t(r,o,h)+w)*i,u=(e(r,o,h)+w)*i,c=+a(r,o,h);if(f>=0&&f<p&&u>=0&&u<y){var d=Math.floor(f),l=Math.floor(u),s=f-d-.5,g=u-l-.5;n[d+l*p]+=(1-s)*(1-g)*c,n[d+1+l*p]+=s*(1-g)*c,n[d+1+(l+1)*p]+=s*g*c,n[d+(l+1)*p]+=(1-s)*g*c}})),d({width:p,height:y,data:n},{width:p,height:y,data:o},f>>u),l({width:p,height:y,data:o},{width:p,height:y,data:n},f>>u),d({width:p,height:y,data:n},{width:p,height:y,data:o},f>>u),l({width:p,height:y,data:o},{width:p,height:y,data:n},f>>u),d({width:p,height:y,data:n},{width:p,height:y,data:o},f>>u),l({width:p,height:y,data:o},{width:p,height:y,data:n},f>>u),n}function A(t){var n=E(t),e=M(n),o=Math.pow(2,2*u);return Array.isArray(e)||(e=r.ticks(Number.MIN_VALUE,r.max(n)/o,e)),c().size([p,y]).thresholds(e.map((t=>t*o)))(n).map(((t,r)=>(t.value=+e[r],m(t))))}function m(t){return t.coordinates.forEach(b),t}function b(t){t.forEach(x)}function x(t){t.forEach(z)}function z(t){t[0]=t[0]*Math.pow(2,u)-w,t[1]=t[1]*Math.pow(2,u)-w}function j(){return p=i+2*(w=3*f)>>u,y=h+2*w>>u,A}return A.contours=function(t){var n=E(t),e=c().size([p,y]),o=Math.pow(2,2*u),a=t=>{t=+t;var r=m(e.contour(n,t*o));return r.value=t,r};return Object.defineProperty(a,"max",{get:()=>r.max(n)/o}),a},A.x=function(r){return arguments.length?(t="function"==typeof r?r:o(+r),A):t},A.y=function(t){return arguments.length?(e="function"==typeof t?t:o(+t),A):e},A.weight=function(t){return arguments.length?(a="function"==typeof t?t:o(+t),A):a},A.size=function(t){if(!arguments.length)return[i,h];var r=+t[0],n=+t[1];if(!(r>=0&&n>=0))throw new Error("invalid size");return i=r,h=n,j()},A.cellSize=function(t){if(!arguments.length)return 1<<u;if(!((t=+t)>=1))throw new Error("invalid cell size");return u=Math.floor(Math.log(t)/Math.LN2),j()},A.thresholds=function(t){return arguments.length?(M="function"==typeof t?t:Array.isArray(t)?o(n.call(t)):o(t),A):M},A.bandwidth=function(t){if(!arguments.length)return Math.sqrt(f*(f+1));if(!((t=+t)>=0))throw new Error("invalid bandwidth");return f=Math.round((Math.sqrt(4*t*t+1)-1)/2),j()},A},t.contours=c,Object.defineProperty(t,"__esModule",{value:!0})}));
